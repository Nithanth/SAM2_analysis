# Data Directory

This directory is intended to store input data for the analysis pipelines.

- **`degradation_map.json`**: (Required for `sam2_eval` pipeline) The JSON file mapping image IDs to ground truth RLE masks and image versions (potentially representing different degradation levels). It uses a nested structure for versions:

  ```json
  {
    "<image_id>": {
      "ground_truth_rle": {
        "size": [H, W],    # Mask dimensions [height, width]
        "counts": "..."     # COCO Run-Length Encoding string for the mask pixels
      },
      "versions": {
        "original":           {"filepath": "images/<id>.jpg", "level": 0, "degradation_type": "original"},
        "gaussian_blur": {
          "5": {"filepath": "pic_degraded/gaussian_blur/<id>_gaussian_blur_5.jpg", "level": 5,  "degradation_type": "gaussian_blur"},
          ...
        },
        "jpeg_compression": {
          "80": {"filepath": "pic_degraded/jpeg_compression/<id>_jpeg_compression_80.jpg", "level": 80,  "degradation_type": "jpeg_compression"}
        }
      }
    },
    ...
  }
  ```

- **`images/`**: Contains the original, undegraded image files. Files are typically named sequentially (e.g., `000001.jpg`).
- **`pic_degraded/`**: Contains subdirectories for each degradation type (e.g., `gaussian_blur`, `jpeg_compression`), which in turn contain the degraded image files named according to the degradation applied (e.g., `000001_gaussian_blur_5.jpg`).
- **`image_annotations/`**: Stores the corresponding ground truth annotations downloaded from the source dataset (e.g., COCO), usually in JSON format, one file per image (e.g., `000001.json`).

These directories and files are typically generated by the `code_degradation.py` script.

## `data_scripts/`

This directory contains Python scripts used for preparing the evaluation dataset:

- **`code_degradation.py`**: Samples images and their annotations from a source dataset (like COCO), downloads them, renames them sequentially, and applies a grid of specified image degradations (e.g., blur, compression, noise). It creates the `images/`, `image_annotations/`, and `pic_degraded/` directory structure.
  - **Usage Example:**

    ```bash
    # Run from the project root directory
    python data/data_scripts/code_degradation.py \
        --coco-annotations /path/to/your/coco/annotations/instances_val2017.json \
        --coco-images /path/to/your/coco/images/val2017 \
        --output-dir data \
        --num-images 100
    ```

    *Requires `pycocotools`, `opencv-python`, `scikit-image`.* Check the script's argument parser (`argparse`) for all options.

- **`code_json.py`**: Scans the `images/`, `pic_degraded/`, and `image_annotations/` directories (created by `code_degradation.py`) to generate the `degradation_map.json` file used by the main evaluation pipeline. It extracts the ground truth mask (in RLE format) from the first annotation in each annotation file.
  - **Usage Example:**

    ```bash
    # Run from the project root directory
    # Assumes data/images, data/pic_degraded, data/image_annotations exist
    python data/data_scripts/code_json.py
    ```

    *Requires `pycocotools`.* The output `degradation_map.json` will be saved in the `data/` directory by default.

- **`code_segmentation_plot.py`**: A utility script for visualizing images and their corresponding segmentation masks (from RLE). Useful for debugging or verifying data.

**Important:** Run `code_degradation.py` *before* `code_json.py`.

**Note:** This directory is ignored by git (see `.gitignore`). Do not commit large data files to the repository.
